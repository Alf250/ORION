
DROP DATABASE orion;
CREATE DATABASE orion;
USE orion;

CREATE TABLE horarios (id SERIAL NOT NULL PRIMARY KEY, inicio_suspencion TIME, fin_suspencion TIME);
CREATE TABLE rangos (id SERIAL NOT NULL PRIMARY KEY, longitud DECIMAL(35,25), latitud DECIMAL(35,25));
CREATE TABLE tiempos_verde (id SERIAL NOT NULL PRIMARY KEY, tiempo_verde INT);
CREATE TABLE tiempos_amarillo (id SERIAL NOT NULL PRIMARY KEY, tiempo_amarillo INT);
CREATE TABLE tiempos_rojo (id SERIAL NOT NULL PRIMARY KEY, tiempo_rojo INT);
CREATE TABLE semaforos (id SERIAL NOT NULL PRIMARY KEY, nombre varchar(15), status BOOLEAN,  tiempo_inicio INT, id_horario INT, id_rango INT, id_tverde INT, id_tamarillo INT, id_trojo INT, fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP);

ALTER TABLE semaforos ADD FOREIGN KEY(id_horario) REFERENCES horarios(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE semaforos ADD FOREIGN KEY(id_rango) REFERENCES rangos(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE semaforos ADD FOREIGN KEY(id_tverde) REFERENCES tiempos_verde(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE semaforos ADD FOREIGN KEY(id_tamarillo) REFERENCES tiempos_amarillo(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE semaforos ADD FOREIGN KEY(id_trojo) REFERENCES tiempos_rojo(id) ON DELETE CASCADE ON UPDATE CASCADE;

CREATE VIEW semaforos_all AS SELECT s.id, s.nombre, s.status, r.longitud, r.latitud, s.tiempo_inicio, h.inicio_suspencion, h.fin_suspencion, tv.tiempo_verde, ta.tiempo_amarillo, tr.tiempo_rojo FROM semaforos s, horarios h, rangos r, tiempos_verde tv, tiempos_amarillo ta, tiempos_rojo tr WHERE h.id=s.id_horario AND r.id=s.id_rango AND tv.id=s.id_tverde AND ta.id=s.id_tamarillo AND tr.id=s.id_trojo ORDER BY s.id ASC;

INSERT INTO horarios (inicio_suspencion, fin_suspencion) VALUES ('08:00:00', '21:00:00');

INSERT INTO rangos (longitud, latitud) VALUES (18.811895, -98.950987);
INSERT INTO rangos (longitud, latitud) VALUES (18.813023, -98.951125);
INSERT INTO rangos (longitud, latitud) VALUES (18.813929, -98.950679);
INSERT INTO rangos (longitud, latitud) VALUES (18.81487, -98.950339);
INSERT INTO rangos (longitud, latitud) VALUES (18.8116114, -98.949890);
INSERT INTO rangos (longitud, latitud) VALUES (18.81889, -98.948888);
INSERT INTO rangos (longitud, latitud) VALUES (18.821833, -98.947960);
INSERT INTO rangos (longitud, latitud) VALUES (18.824087, -98.947033);
INSERT INTO rangos (longitud, latitud) VALUES (18.825672, -98.946591);
INSERT INTO rangos (longitud, latitud) VALUES (18.831656, -98.944309);
INSERT INTO rangos (longitud, latitud) VALUES (18.834101, -98.943433);
INSERT INTO rangos (longitud, latitud) VALUES (18.836713, -98.942503);
INSERT INTO rangos (longitud, latitud) VALUES (18.838163, -98.941984);
INSERT INTO rangos (longitud, latitud) VALUES (18.841874, -98.940645);
INSERT INTO rangos (longitud, latitud) VALUES (18.846753, -98.938898);
INSERT INTO rangos (longitud, latitud) VALUES (18.847276, -98.938720);

INSERT INTO tiempos_verde (tiempo_verde) VALUES (47);
INSERT INTO tiempos_verde (tiempo_verde) VALUES (62);
INSERT INTO tiempos_verde (tiempo_verde) VALUES (57);
INSERT INTO tiempos_verde (tiempo_verde) VALUES (56);
INSERT INTO tiempos_verde (tiempo_verde) VALUES (37);
INSERT INTO tiempos_verde (tiempo_verde) VALUES (67);
INSERT INTO tiempos_verde (tiempo_verde) VALUES (48);

INSERT INTO tiempos_amarillo (tiempo_amarillo) VALUES (3);

INSERT INTO tiempos_rojo (tiempo_rojo) VALUES (31);
INSERT INTO tiempos_rojo (tiempo_rojo) VALUES (35);
INSERT INTO tiempos_rojo (tiempo_rojo) VALUES (40);
INSERT INTO tiempos_rojo (tiempo_rojo) VALUES (41);
INSERT INTO tiempos_rojo (tiempo_rojo) VALUES (20);
INSERT INTO tiempos_rojo (tiempo_rojo) VALUES (19);
INSERT INTO tiempos_rojo (tiempo_rojo) VALUES (50);
INSERT INTO tiempos_rojo (tiempo_rojo) VALUES (30);

INSERT INTO semaforos (nombre, status, tiempo_inicio, id_horario, id_rango, id_tverde, id_tamarillo, id_trojo) VALUES ('Ni√±o artillero',true,15,1,1,1,1,1);
INSERT INTO semaforos (nombre, status, tiempo_inicio, id_horario, id_rango, id_tverde, id_tamarillo, id_trojo) VALUES ('Bodega',true,36,1,2,2,1,2);
INSERT INTO semaforos (nombre, status, tiempo_inicio, id_horario, id_rango, id_tverde, id_tamarillo, id_trojo) VALUES ('Porcelanite',true,42,1,3,3,1,3);
INSERT INTO semaforos (nombre, status, tiempo_inicio, id_horario, id_rango, id_tverde, id_tamarillo, id_trojo) VALUES ('Vasco',true,42,1,4,3,1,3);
INSERT INTO semaforos (nombre, status, tiempo_inicio, id_horario, id_rango, id_tverde, id_tamarillo, id_trojo) VALUES ('Comex',true,64,1,5,3,1,3);
INSERT INTO semaforos (nombre, status, tiempo_inicio, id_horario, id_rango, id_tverde, id_tamarillo, id_trojo) VALUES ('F. Aorro E.Z.',true,23,1,6,4,1,1);
INSERT INTO semaforos (nombre, status, tiempo_inicio, id_horario, id_rango, id_tverde, id_tamarillo, id_trojo) VALUES ('Mercado nuevo',true,82,,1,7,4,1,4);
INSERT INTO semaforos (nombre, status, tiempo_inicio, id_horario, id_rango, id_tverde, id_tamarillo, id_trojo) VALUES ('Sofista',true,22,1,8,1,1,5);
INSERT INTO semaforos (nombre, status, tiempo_inicio, id_horario, id_rango, id_tverde, id_tamarillo, id_trojo) VALUES ('Littel ceaser',true,57,1,9,5,1,6);
INSERT INTO semaforos (nombre, status, tiempo_inicio, id_horario, id_rango, id_tverde, id_tamarillo, id_trojo) VALUES ('Honda',true,80,1,10,3,1,7);
INSERT INTO semaforos (nombre, status, tiempo_inicio, id_horario, id_rango, id_tverde, id_tamarillo, id_trojo) VALUES ('Pare de sufrir',true,4,1,1,6,1,3);
INSERT INTO semaforos (nombre, status, tiempo_inicio, id_horario, id_rango, id_tverde, id_tamarillo, id_trojo) VALUES ('Crevrolet',true,18,1,12,3,1,8);
INSERT INTO semaforos (nombre, status, tiempo_inicio, id_horario, id_rango, id_tverde, id_tamarillo, id_trojo) VALUES ('Lasvias',true,1,1,13,3,1,4);
INSERT INTO semaforos (nombre, status, tiempo_inicio, id_horario, id_rango, id_tverde, id_tamarillo, id_trojo) VALUES ('Coppel',true,67,1,14,7,1,2);
INSERT INTO semaforos (nombre, status, tiempo_inicio, id_horario, id_rango, id_tverde, id_tamarillo, id_trojo) VALUES ('Elektra',true,92,1,15,2,1,2);
INSERT INTO semaforos (nombre, status, tiempo_inicio, id_horario, id_rango, id_tverde, id_tamarillo, id_trojo) VALUES ('Mega',true,92,1,16,2,1,2);

select * from semaforos;

SELECT s.id, s.nombre, s.status, r.longitud, r.latitud, s.tiempo_inicio, h.inicio_suspencion, h.fin_suspencion, tv.tiempo_verde, ta.tiempo_amarillo, tr.tiempo_rojo FROM semaforos s, horarios h, rangos r, tiempos_verde tv, tiempos_amarillo ta, tiempos_rojo tr WHERE h.id=s.id_horario AND r.id=s.id_rango AND tv.id=s.id_tverde AND ta.id=s.id_tamarillo AND tr.id=s.id_trojo ORDER BY s.id ASC;
SELECT s.id, s.nombre, s.status, r.longitud, r.latitud, s.tiempo_inicio, h.inicio_suspencion, h.fin_suspencion, tv.tiempo_verde, ta.tiempo_amarillo, tr.tiempo_rojo FROM semaforos s, horarios h, rangos r, tiempos_verde tv, tiempos_amarillo ta, tiempos_rojo tr WHERE h.id=s.id_horario AND r.id=s.id_rango AND tv.id=s.id_tverde AND ta.id=s.id_tamarillo AND tr.id=s.id_trojo AND s.id= :id;

SELECT * FROM horarios WHERE inicio_suspencion='08:00:00' AND fin_suspencion='21:00:00';

SELECT * FROM rangos WHERE longitud=18.8381630000 AND latitud=-98.9419840000;

SELECT * FROM tiempos_verde WHERE tiempo_verde= 67;